<div class="chat-container">
  <div class="messages">
    <div *ngFor="let m of messages" class="msg" [class.user]="m.role==='user'" [class.typing]="m.typing">
      <ng-container *ngIf="!m.typing; else typingTpl">
        {{ m.text }}
      </ng-container>
    </div>
  </div>

  <!-- Quick replies -->
  <div *ngIf="ui && ($any(ui).type === 'choices')" class="choices">
    <button
      *ngFor="let q of $any(ui).buttons"
      class="chip"
      (click)="clickQuickReply(q)"
      [disabled]="loading"
    >
      {{ q.title }}
    </button>
  </div>

  <!-- Single open input (POST to /chat/) -->
  <div *ngIf="chatMode==='open' && ui?.openInput && ui?.inputType==='single'" class="composer">
    <input #msgInput type="text"
           placeholder="Vnesite odgovor..."
           [disabled]="loading"
           (keyup.enter)="onSubmitSingle(msgInput)" />
    <button (click)="onSubmitSingle(msgInput)" [disabled]="loading">Pošlji</button>
  </div>

  <!-- Dual open input (POST to /chat/survey) -->
  <div *ngIf="chatMode==='open' && ui?.openInput && ui?.inputType==='dual'" class="composer dual-input">
    <input #msgInput1 type="text"
           placeholder="Kako običajno pridobivate stranke?"
           [disabled]="loading" />
    <input #msgInput2 type="text"
           placeholder="Kdo običajno odgovarja na nove kontakte?"
           [disabled]="loading" />
    <button (click)="onSubmitSurvey(msgInput1, msgInput2)" [disabled]="loading">Pošlji</button>
  </div>
</div>

<ng-template #typingTpl>
  <div class="typing-dots">
    <span class="dot"></span><span class="dot"></span><span class="dot"></span>
  </div>
</ng-template>
